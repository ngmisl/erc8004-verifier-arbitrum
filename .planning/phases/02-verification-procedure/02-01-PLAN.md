---
phase: 02-verification-procedure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - public/ERC8004-SKILL.md
autonomous: true
requirements: [QA-01, QA-02, VFY-01, VFY-02]

must_haves:
  truths:
    - "An agent reading ## Verification Procedure sees a numbered step sequence starting with field extraction and ending with address collection"
    - "An agent can copy the personal_ecRecover JSON body, substitute hash and sig values from a signed block, and receive a signer address"
    - "The getAgentWallet(uint256) selector 0x00339509 appears in the document (QA-01 resolved)"
    - "The personal_ecRecover params order is [hash, sig] matching chain.cljs behavior (QA-02 resolved)"
  artifacts:
    - path: "public/ERC8004-SKILL.md"
      provides: "Verification Procedure intro, Step 1 (extract fields), Step 2 (personal_ecRecover spec with template + worked example)"
      contains: "### Step 1"
    - path: "public/ERC8004-SKILL.md"
      provides: "personal_ecRecover template and worked example"
      contains: "personal_ecRecover"
  key_links:
    - from: "## Verification Procedure > ### Step 1"
      to: "## Signed Block Format"
      via: "cross-reference by field name"
      pattern: "hash.*field|sig.*field|Signed Block Format"
    - from: "## Verification Procedure > ### Step 1"
      to: "## Agent Identity"
      via: "cross-reference for registryAddress and agentId"
      pattern: "Agent Identity|registryAddress|agentId"
    - from: "## Verification Procedure > ### Step 2"
      to: "personal_ecRecover params"
      via: "template JSON body with placeholder substitution"
      pattern: "personal_ecRecover"
---

<objective>
Write the opening of the Verification Procedure section in ERC8004-SKILL.md: procedure introduction (what the steps produce, concurrency note), Step 1 (extract fields from signed block — cross-references Phase 1), and Step 2 (personal_ecRecover JSON-RPC spec with template and worked example).

Purpose: Gives agents the first two steps of the verification procedure — parsing input and recovering the signer address via JSON-RPC. Resolves QA-01 (correct getAgentWallet selector stated) and QA-02 (personal_ecRecover params semantics confirmed) inline.

Output: public/ERC8004-SKILL.md with `<!-- Phase 2 -->` partially replaced by Steps 1-2.
</objective>

<execution_context>
@/home/teresa/.claude/get-shit-done/workflows/execute-plan.md
@/home/teresa/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-verification-procedure/02-RESEARCH.md
@.planning/phases/02-verification-procedure/02-CONTEXT.md
@.planning/phases/01-skill-doc-foundation/01-02-SUMMARY.md
@public/ERC8004-SKILL.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Write procedure intro, Step 1 (extract fields), and Step 2 (personal_ecRecover)</name>
  <files>public/ERC8004-SKILL.md</files>
  <action>
Replace the `<!-- Phase 2 -->` placeholder in the `## Verification Procedure` section with the content described below. Keep the `## Result` heading and everything after it intact.

IMPORTANT: Do NOT remove the Phase 2 comment entirely yet — Plan 02-02 will append Steps 3-4 and the RPC Endpoints subsection. Instead, write Steps 1-2 ABOVE a remaining `<!-- Phase 2 continued -->` marker that Plan 02-02 will replace.

Structure to write:

**Procedure intro paragraph** (2-3 sentences):
- State what the procedure produces: a recovered signer address from the signature, plus two on-chain addresses (agent wallet and NFT owner) from the registry contract.
- State that all calls are JSON-RPC over HTTP POST to an Arbitrum RPC endpoint, with `Content-Type: application/json`.
- Note: Steps 2, 3, and 4 are independent and may run concurrently.

**### Step 1: Extract Fields**
- One sentence: extract the required fields from the signed block for use in subsequent steps.
- Cross-reference by name per locked decision: "From the signed block (see Signed Block Format above), extract the `hash:` field and the `sig:` field."
- Cross-reference Agent Identity: "From the agent identity string in the `Signed by` line (see Agent Identity above), extract the `chainId`, `registryAddress`, and `agentId` components."
- State what the agent now has: five values (hash, sig, chainId, registryAddress, agentId).

**### Step 2: Recover Signer (personal_ecRecover)**
- One sentence intro: recover the address that produced the signature by calling `personal_ecRecover`.
- State: "Pass the `hash:` field value directly as `params[0]`. Pass the `sig:` field value directly as `params[1]`. The RPC node applies the EIP-191 prefix internally." (Per QA-02 resolution.)
- Template JSON body (with placeholders):
```json
{
  "jsonrpc": "2.0",
  "id": 1,
  "method": "personal_ecRecover",
  "params": [
    "<hash: field value>",
    "<sig: field value>"
  ]
}
```
- Response template:
```json
{
  "jsonrpc": "2.0",
  "id": 1,
  "result": "<recovered signer address>"
}
```
- Worked example using the synthetic data from Phase 1 (same hash and sig values from the Example: Required Fields Only section). Use the hash `0x57caa12b4f8c3d9e2a1b7f4c6e8d0a3b5f7c9e1d3a5b7c9e1f3a5b7c9e1f3a5` and sig `0xf13bd8a9c7e4d2f0b1a5c8e3f7b2d9a6e4c1f8b0d3a2e5f7c9b4d6e8a1f3c2e5d7b9a0c3f6e8b1d4a2e5c7f9b0d3a6` from Phase 1. Show the full request JSON with these values substituted. Show a synthetic response with a plausible address.
- Synthetic data disclaimer as blockquote: `> These values are synthetic. Do not use for on-chain verification.` (Per Phase 1 precedent.)
- State the result: "The `result` field is the recovered signer address. Save this for comparison in the Result step."

After Step 2, leave a `<!-- Phase 2 continued -->` marker for Plan 02-02 to replace with Steps 3-4 and RPC Endpoints.

Style notes:
- Use the same terse, imperative spec voice established in Phase 1.
- JSON bodies only (no HTTP wrapper). The POST URL and Content-Type are stated once in the intro.
- No inline error handling — Phase 3 covers errors.
- No response decoding explanation per user decision.
  </action>
  <verify>
Read public/ERC8004-SKILL.md and confirm:
1. `## Verification Procedure` heading exists with intro paragraph mentioning concurrency
2. `### Step 1: Extract Fields` exists with cross-references to "Signed Block Format" and "Agent Identity"
3. `### Step 2: Recover Signer (personal_ecRecover)` exists with template JSON and worked example
4. `personal_ecRecover` params order is [hash, sig] (hash first)
5. `<!-- Phase 2 continued -->` marker is present after Step 2
6. `## Result` heading still exists below
7. No response decoding explanation appears
8. Synthetic data disclaimer blockquote is present
  </verify>
  <done>
The Verification Procedure section contains an intro paragraph (with concurrency note, JSON-RPC over HTTP POST statement), Step 1 (field extraction with cross-references), and Step 2 (personal_ecRecover template + worked example). QA-01 is resolved (correct selector 0x00339509 will appear in Plan 02-02's content, but is acknowledged in the plan). QA-02 is resolved (params[0]=hash, params[1]=sig, RPC handles prefix). A continuation marker exists for Plan 02-02.
  </done>
</task>

</tasks>

<verification>
- public/ERC8004-SKILL.md contains `### Step 1` and `### Step 2` under `## Verification Procedure`
- The intro mentions Steps 2, 3, 4 can run concurrently
- `personal_ecRecover` template shows params: [hash, sig] in that order
- Cross-references use field names ("Signed Block Format", "Agent Identity") without repeating definitions
- `## Result` section is untouched
- No Phase 3 content (pass/fail, error conditions) is present
- Synthetic data disclaimer appears as blockquote
</verification>

<success_criteria>
An agent reading the Verification Procedure section can: (1) identify what five values to extract from a signed block, (2) construct a personal_ecRecover JSON-RPC request by substituting hash and sig, and (3) understand the response contains the recovered signer address. The section flows naturally from Phase 1's content and leaves a clear insertion point for Steps 3-4.
</success_criteria>

<output>
After completion, create `.planning/phases/02-verification-procedure/02-01-SUMMARY.md`
</output>
