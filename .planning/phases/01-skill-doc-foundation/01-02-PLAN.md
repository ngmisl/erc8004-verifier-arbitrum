---
phase: 01-skill-doc-foundation
plan: 02
type: execute
wave: 2
depends_on:
  - "01-01"
files_modified:
  - public/ERC8004-SKILL.md
autonomous: true
requirements:
  - FMT-01
  - FMT-02
  - FMT-03
  - SIGN-01

must_haves:
  truths:
    - "An agent can parse any signed block by reading the Fields table — every field has its line pattern, required/optional flag, and a one-liner description"
    - "An agent seeing the required-only example can identify the four mandatory lines (separator, Signed by, sig, hash) and distinguish them from optional fields"
    - "An agent seeing the all-fields example can identify ts and Verify as optional additions"
    - "An agent can decompose any eip155:chainId:registryAddress:agentId string into its four components using the field breakdown"
    - "An agent knows the sign_content tool name, that input must be raw text only, and that the output must be displayed as a single unmodified code block"
  artifacts:
    - path: "public/ERC8004-SKILL.md"
      provides: "Complete Phase 1 content — format spec, identity format, signing instructions"
      contains: "### Fields"
  key_links:
    - from: "### Fields"
      to: "### Example: Required Fields Only"
      via: "table defines fields, example demonstrates them in context"
      pattern: "\\| Field.*\\| Required"
    - from: "### Format"
      to: "### Field Breakdown"
      via: "format string shown, then decomposed component by component"
      pattern: "eip155:<chainId>:<registryAddress>:<agentId>"
    - from: "### Tool Interface"
      to: "### Display Rules"
      via: "tool produces output, display rules govern how agent presents it"
      pattern: "sign_content"
---

<objective>
Fill in the Phase 1 placeholder sections of ERC8004-SKILL.md: complete signed block format spec with field table and two annotated examples, agent identity format with field breakdown and supported chains, and signing instructions rewritten from ai.html content.

Purpose: After this plan, ERC8004-SKILL.md contains everything an agent needs to recognize signed blocks, understand agent identity strings, and use the signing tool correctly.

Output: `public/ERC8004-SKILL.md` with all Phase 1 sections populated (Signed Block Format, Agent Identity, Signing Instructions).
</objective>

<execution_context>
@/home/teresa/.claude/get-shit-done/workflows/execute-plan.md
@/home/teresa/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-skill-doc-foundation/01-CONTEXT.md
@.planning/phases/01-skill-doc-foundation/01-RESEARCH.md
@.planning/phases/01-skill-doc-foundation/01-01-SUMMARY.md
@public/ERC8004-SKILL.md
@src/verify/parse.cljs
@public/ai.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Write signed block format spec (FMT-01, FMT-03)</name>
  <files>public/ERC8004-SKILL.md</files>
  <action>
Replace the placeholder content under `## Signed Block Format` with the complete format specification.

**### Fields** (FMT-01)
Create a table with columns: Field, Line Pattern, Required, Description.

Rows (derived from parse.cljs canonical regexes):

| Field | Line Pattern | Required | Description |
|-------|-------------|----------|-------------|
| Separator | `---` (three or more dashes) | Yes | Anchors the signature footer; separates content from metadata |
| Agent line | `Signed by <name> (<fullId>)` | Yes | Agent display name and full identity string |
| `sig:` | `sig: 0x<hex>` | Yes | 65-byte ECDSA signature (130 hex characters) |
| `hash:` | `hash: 0x<hex>` | Yes | Pre-computed EIP-191 hash -- passed directly to ecRecover; do not recompute from content |
| `ts:` | `ts: <ISO 8601>` | No | Signing timestamp |
| `Verify:` | `Verify: <URL>` | No | Verification link; display only |

CRITICAL per user decision and Pitfall 5: The hash field description MUST include the one-liner "pre-computed EIP-191 hash -- passed directly to ecRecover; do not recompute from content." This prevents agents from attempting hash computation.

After the table, add a brief "Parser behavior" note: The parser anchors on the `Signed by` line, finds the nearest `---` before it (skipping blank lines). Content is everything before the separator. Footer fields may appear in any order, but convention is: agent line, sig, hash, ts, Verify.

**### Example: Required Fields Only** (FMT-03, first example)
Show a minimal signed block using synthetic data from the research. Use the "show-then-explain" annotation style (per research recommendation and Claude's discretion):

First, a fenced code block with only the four required fields:
```
Approved: invoice #4872 for $2,400. Payment authorized.

---
Signed by Keystone (eip155:42161:0x8004b3A873394d8B0Af8fD5D9C5D5a432:5)
sig: 0xf13bd8a9c7e4d2f0b1a5c8e3f7b2d9a6e4c1f8b0d3a2e5f7c9b4d6e8a1f3c2e5d7b9a0c3f6e8b1d4a2e5c7f9b0d3a6
hash: 0x57caa12b4f8c3d9e2a1b7f4c6e8d0a3b5f7c9e1d3a5b7c9e1f3a5b7c9e1f3a5
```

Then a line-by-line explanation list below:
- Line 1: Content (the signed message)
- Blank line: Separates content from footer
- `---`: Separator
- `Signed by ...`: Agent name and full identity
- `sig: ...`: ECDSA signature
- `hash: ...`: EIP-191 content hash

Note beneath: "These values are synthetic. Do not use for on-chain verification."

**### Example: All Fields** (FMT-03, second example)
Same content but with ts: and Verify: added:
```
Approved: invoice #4872 for $2,400. Payment authorized.

---
Signed by Keystone (eip155:42161:0x8004b3A873394d8B0Af8fD5D9C5D5a432:5)
sig: 0xf13bd8a9c7e4d2f0b1a5c8e3f7b2d9a6e4c1f8b0d3a2e5f7c9b4d6e8a1f3c2e5d7b9a0c3f6e8b1d4a2e5c7f9b0d3a6
hash: 0x57caa12b4f8c3d9e2a1b7f4c6e8d0a3b5f7c9e1d3a5b7c9e1f3a5b7c9e1f3a5
ts: 2026-02-19T14:32:15.000Z
Verify: https://erc8004.orbiter.website/#eyJzIjoiMHhmMTNi...
```

Then note the two additional fields: `ts:` (signing timestamp) and `Verify:` (verification link). Both optional.

Voice: Terse. No "let's look at" or "here we can see." Just the code block, then the field list.
  </action>
  <verify>
1. `grep -c "^|" public/ERC8004-SKILL.md` shows table rows exist under ### Fields
2. Verify the hash field row contains "do not recompute"
3. Verify two fenced code blocks exist under the example subsections
4. Verify "synthetic" disclaimer is present
5. Verify `ts:` and `Verify:` appear in the all-fields example but NOT in the required-only example
  </verify>
  <done>
- Fields table has 6 rows (separator, agent line, sig, hash, ts, Verify) with Required column
- hash field includes "pre-computed EIP-191 hash" one-liner
- Required-only example shows exactly 4 footer lines (separator, Signed by, sig, hash)
- All-fields example adds ts and Verify lines
- Both examples use synthetic data with disclaimer
- Show-then-explain annotation style used
  </done>
</task>

<task type="auto">
  <name>Task 2: Write agent identity format (FMT-02) and signing instructions (SIGN-01)</name>
  <files>public/ERC8004-SKILL.md</files>
  <action>
Replace the placeholder content under `## Agent Identity` and `## Signing Instructions` with full content.

**## Agent Identity** (FMT-02)

**### Format**
State the pattern: `eip155:<chainId>:<registryAddress>:<agentId>`

Show a worked example per user decision (complete string, then break apart):
Complete string: `eip155:42161:0x8004b3A873394d8B0Af8fD5D9C5D5a432:5`

**### Field Breakdown**
Table decomposing the example:

| Component | Value | Type | Description |
|-----------|-------|------|-------------|
| `eip155` | `eip155` | literal prefix | EIP-155 chain namespace identifier |
| `chainId` | `42161` | decimal integer | Arbitrum One chain ID |
| `registryAddress` | `0x8004b3A873394d8B0Af8fD5D9C5D5a432` | 0x-prefixed hex, 20 bytes | ERC-8004 registry contract address |
| `agentId` | `5` | decimal integer | NFT token ID in the registry |

**### Supported Chains**
Table:

| Chain ID | Network | RPC Endpoint |
|----------|---------|-------------|
| 42161 | Arbitrum One | `https://arb1.arbitrum.io/rpc` |
| 421614 | Arbitrum Sepolia | `https://sepolia-rollup.arbitrum.io/rpc` |

---

**## Signing Instructions** (SIGN-01)
Rewrite ai.html content in terse spec voice. Per user decision: rewrite for new voice, preserve field names, ERC8004-SKILL.md is sole authority (no mention of ai.html).

**### Tool Interface**
- Tool name: `sign_content`
- Input: raw content text only. Strip all labels, commentary, formatting, and preamble. Pass only the message text.
- Output: copy-paste ready block containing the original content followed by the signature footer.

**### Output Format**
Show the template structure:
```
<content>

---
Signed by <AgentName> (<fullId>)
sig: 0x<signature>
hash: 0x<hash>
ts: <ISO 8601 timestamp>
Verify: <URL>
```

One-line note: Output includes all fields (required and optional). The tool produces the complete block; the agent does not construct it manually.

**### Display Rules**
Imperative list:
- Present the entire signed block as a single code block.
- No preamble, commentary, or explanation before or after the block.
- Do not modify, reformat, or truncate any part of the signature footer.
- The Verify link must remain intact and clickable.

Voice: Imperatives throughout. "Present..." not "You should present..." Terse, no rationale needed for display rules.
  </action>
  <verify>
1. Verify `eip155:42161:0x8004b3A873394d8B0Af8fD5D9C5D5a432:5` appears in Agent Identity section
2. Verify field breakdown table has 4 component rows
3. Verify supported chains table has Arbitrum One (42161) and Arbitrum Sepolia (421614)
4. Verify `sign_content` appears in Signing Instructions
5. Verify all four display rules are present as imperative statements
6. Verify no mention of "ai.html" anywhere in the file
7. Verify output format template block exists under ### Output Format
  </verify>
  <done>
- Agent Identity shows complete format string and decomposes it into 4 labeled components
- Supported Chains lists both Arbitrum networks with chain IDs and RPC endpoints
- Signing Instructions names sign_content tool with input/output spec
- Output format template matches the signed block structure
- Four display rules stated as imperatives
- No mention of ai.html in the document
- All content in terse spec voice
  </done>
</task>

</tasks>

<verification>
Full Phase 1 verification after this plan completes:
1. `public/ERC8004-SKILL.md` exists with all 9 H2 sections
2. `## Signed Block Format` has complete field table (6 rows), two annotated examples, parser behavior note
3. `## Agent Identity` has format pattern, worked example with field breakdown (4 components), supported chains (2 rows)
4. `## Signing Instructions` has tool interface (sign_content), output format template, four display rules
5. Hash field description includes "do not recompute" language
6. No mention of ai.html, keccak256 computation formula, or verification procedure details
7. All examples use synthetic data with disclaimer
8. Terse spec voice throughout — no hand-holding, no conceptual introductions
</verification>

<success_criteria>
An agent reading ERC8004-SKILL.md can: (1) parse any signed block using the field table and examples, (2) decompose any eip155 full ID into its four components, (3) determine which chain to query from the chain ID, (4) know the tool name and rules for producing signed blocks. The document reads as a terse reference spec, not a tutorial.
</success_criteria>

<output>
After completion, create `.planning/phases/01-skill-doc-foundation/01-02-SUMMARY.md`
</output>
